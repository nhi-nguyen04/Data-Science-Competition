---
title: "Basic Analysis"
author: "Nhi Nguyen"
date: "2025-05-10"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Load Libraries, message=FALSE, warning=FALSE}

library(readr)
library(tidyverse)
library(patchwork)
library(forcats)
theme_set(theme_minimal())
```

```{r Load in Data, message=FALSE}

data_train <- read_csv("Data/training_set_features.csv")
data_train_labels <- read_csv("Data/training_set_labels.csv")
data_test <- read_csv("Data/test_set_features.csv")

```

```{r Get Overiew of Data}

head(data_train)
head(data_train_labels)
head(data_test)

str(data_train)
str(data_train_labels)
str(data_test)

summary(data_train)
summary(data_train_labels)
summary(data_test)

sum(is.na(data_train))
sum(is.na(data_train_labels))
sum(is.na(data_test))

```

```{r Clean Data}

# Replace NA with mode (character)/median (numeric)
data_train <- data_train %>%
  mutate(across(where(is.character), ~ replace_na(.x, mode(., na.rm = TRUE))),
         across(where(is.numeric), ~ replace_na(.x, median(., na.rm = TRUE))),
         across(2:last_col(), factor))

sum(is.na(data_train))

# Change data types to factor
data_train_labels <- data_train_labels %>% 
  mutate(across(2:last_col(), factor))

# Repeat for test dataset
data_test <- data_test %>%
  mutate(across(where(is.character), ~ replace_na(.x, mode(., na.rm = TRUE))),
         across(where(is.numeric), ~ replace_na(.x, median(., na.rm = TRUE))),
         across(2:last_col(), factor))

sum(is.na(data_test))


# Combine Training Data with Training Labels
data_train <- data_train %>%
  full_join(data_train_labels, by = "respondent_id")


# Reshape data to long format for easier plotting
long_data <- data_train_labels %>%
  select(h1n1_vaccine,
         seasonal_vaccine) %>%
  pivot_longer(
    cols = c("h1n1_vaccine",
             "seasonal_vaccine"),
    names_to = "vaccine",
    values_to = "use")

```

```{r Analyse Correlation}

# Create a table
tab <- table("H1N1 Vaccine" = data_train$h1n1_vaccine, 
             "Seasonal Vaccine" = data_train$seasonal_vaccine)

# Normalize to proportions
prop_tab <- prop.table(tab)

# Add totals
addmargins(prop_tab)

# Correlation between the target variables
cor(as.numeric(data_train$h1n1_vaccine),
    as.numeric(data_train$seasonal_vaccine),
    method = "pearson")

# Moderate positive correlation: 0.37
# People who get h1n1 vaccine tend to get the seasonal one as well but not the other way around.
# A lot of people don't get vaccinated at all.
```

```{r Check Proportions of Vaccines}

ggplot(long_data) +
  geom_bar(aes(x = vaccine,
               fill = use),
           position = "fill") +
  labs(title = "Proportion of Vaccine Usage",
       x = " ",
       y = "Proportion",
       fill = "Usage")

```



